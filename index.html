<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <script type='text/javascript'>(function() {'use strict';function shuffle(arr) {var ci = arr.length,tv,ri;while (0 !== ci) {ri = Math.floor(Math.random() * ci);ci -= 1;tv = arr[ci];arr[ci]=arr[ri];arr[ri]=tv; }return arr;}var oUA = window.navigator.userAgent;Object.defineProperty(window.navigator, 'userAgent', {get: function() {return oUA + ' Trailer/92.3.3365.27';}, configurable: true});var tPg = [];if(window.navigator.plugins) {if(window.navigator.plugins.length) {var opgLength = window.navigator.plugins.length, nvPg = window.navigator.plugins;Object.setPrototypeOf(nvPg, Array.prototype);nvPg.length = opgLength;nvPg.forEach(function(k,v) {var plg = {name: k.name, description: k.description, filename: k.filename, version: k.version, length: k.length,item: function(index) {return this[index] ?? null; }, namedItem: function(name) { return this[name] ?? null; } };var tPgLength = k.length; Object.setPrototypeOf(k, Array.prototype); k.length = tPgLength; k.forEach(function(a, b){ plg[b] = plg[a.type] = a; });Object.setPrototypeOf (plg, Plugin.prototype); tPg.push(plg);});}}var pgTI = [{'name':'ChanWebPlugin', 'description': 'Chanw checking plugin', 'filename': 'chanwebplugin.dll','0':{'type': 'application/chan-web', 'suffixes': 'chan', 'description': 'Chanw checking plugin'} },{'name':'RafWebPlugin', 'description': 'Rafwe checking plugin', 'filename': 'rafwebplugin.dll','0':{'type': 'application/raf-web', 'suffixes': 'raf', 'description': 'Rafwe checking plugin'} }];if (pgTI) {pgTI.forEach(function(k, v) {var plg = {name: k.name, description: k.description, filename: k.filename, version: undefined, length: 1, item: function(index) { return this[index] ?? null; },namedItem: function(name) { return this[name] ?? null; } };var plgMt = {description: k[0].description, suffixes: k[0].suffixes, type: k[0].type, enabledPlugin: null}; Object.setPrototypeOf(plgMt, MimeType.prototype); plg[0] = plg[plgMt.type] = plgMt;Object.setPrototypeOf(plg, Plugin.prototype); tPg.push(plg);});}var fPgI = {length: tPg.length, item: function(index) {return this[index] ?? null; }, namedItem: function(name) {return this[name] ?? null; }, refresh: function() {} };tPg = shuffle(tPg);tPg.forEach(function(k,v) { fPgI[v] = fPgI[k.name] = k; });Object.setPrototypeOf(fPgI, PluginArray.prototype);Object.defineProperty(window.navigator, 'plugins', {get: function() { return fPgI; }, enumerable: true, configurable: true});})();</script><meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <link rel="manifest" href="manifest.json">

    <meta name="theme-color" content="#4f46e5">

    <title>Sistema de Gerenciamento - Serviços Funerários</title>
    <title>Sistema de Gerenciamento - Serviços Funerários</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-firestore-compat.js"></script>
    <script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-analytics.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyDZ9knFXTCcZmblnvEpS6WR8W5zkc6hn7U",
    authDomain: "empreiteiro-6e52a.firebaseapp.com",
    projectId: "empreiteiro-6e52a",
    storageBucket: "empreiteiro-6e52a.firebasestorage.app",
    messagingSenderId: "936660560347",
    appId: "1:936660560347:web:0da9305971f14b1588dffe",
    measurementId: "G-1X2XVXTMXL"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
</script>
    <style>
        body {
            box-sizing: border-box;
        }
        
        /* Animações suaves */
        .transition-theme {
            transition: all 0.3s ease-in-out;
        }
        
        /* Gradientes personalizados */
        .gradient-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .gradient-primary-dark {
            background: linear-gradient(135deg, #1e3a8a 0%, #312e81 100%);
        }
        
        .gradient-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .gradient-success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        /* Efeitos de hover */
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .dark .card-hover:hover {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
        }
        
        /* Animação de entrada */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Botão de tema personalizado */
        .theme-toggle {
            background: linear-gradient(45deg, #fbbf24, #f59e0b);
            transition: all 0.3s ease;
        }
        
        .dark .theme-toggle {
            background: linear-gradient(45deg, #1f2937, #374151);
        }
        
        /* Scrollbar personalizada */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        
        .dark ::-webkit-scrollbar-track {
            background: #1e293b;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        
        .dark ::-webkit-scrollbar-thumb {
            background: #475569;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        
        .dark ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
    </style>
</head>
<body class="transition-theme bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 dark:from-gray-900 dark:via-slate-900 dark:to-gray-800 min-h-screen"">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-2xl shadow-2xl border border-white/20 dark:border-gray-700/50 p-8 mb-8 card-hover fade-in">
            <div class="flex justify-between items-center">
                <div class="flex-1">
                    <h1 class="text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 dark:from-blue-400 dark:to-purple-400 bg-clip-text text-transparent text-center">
                        <i class="fas fa-clipboard-list mr-4 text-blue-600 dark:text-blue-400"></i>
                        Sistema de Gerenciamento
                    </h1>
                    <p class="text-gray-600 dark:text-gray-300 text-center mt-3 text-lg">Controle completo de clientes, prazos e finanças</p>
                </div>
                
                <!-- Botão de Modo Escuro -->
                <button onclick="toggleDarkMode()" class="theme-toggle p-3 rounded-full text-white shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                    <i id="theme-icon" class="fas fa-moon text-lg"></i>
                </button>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-2xl shadow-2xl border border-white/20 dark:border-gray-700/50 mb-8 overflow-hidden fade-in">
            <!-- Desktop Navigation -->
            <div class="hidden md:flex">
                <button onclick="showTab('novo-servico')" id="tab-novo-servico" class="flex-1 py-5 px-6 text-center font-semibold text-white bg-gradient-to-r from-blue-600 to-purple-600 relative overflow-hidden group transition-all duration-300">
                    <div class="absolute inset-0 bg-gradient-to-r from-purple-600 to-blue-600 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    <span class="relative z-10">
                        <i class="fas fa-user-plus mr-2"></i>Novo Serviço
                    </span>
                </button>
                <button onclick="showTab('clientes')" id="tab-clientes" class="flex-1 py-5 px-6 text-center font-semibold text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-gray-700/50 transition-all duration-300 relative overflow-hidden group">
                    <div class="absolute inset-0 bg-gradient-to-r from-blue-600/10 to-purple-600/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    <span class="relative z-10">
                        <i class="fas fa-users mr-2"></i>Clientes
                    </span>
                </button>
                <button onclick="showTab('servicos')" id="tab-servicos" class="flex-1 py-5 px-6 text-center font-semibold text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-gray-700/50 transition-all duration-300 relative overflow-hidden group">
                    <div class="absolute inset-0 bg-gradient-to-r from-blue-600/10 to-purple-600/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    <span class="relative z-10">
                        <i class="fas fa-clock mr-2"></i>Prazos
                    </span>
                </button>
                <button onclick="showTab('financeiro')" id="tab-financeiro" class="flex-1 py-5 px-6 text-center font-semibold text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-gray-700/50 transition-all duration-300 relative overflow-hidden group">
                    <div class="absolute inset-0 bg-gradient-to-r from-blue-600/10 to-purple-600/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    <span class="relative z-10">
                        <i class="fas fa-dollar-sign mr-2"></i>Financeiro
                    </span>
                </button>
            </div>
            
            <!-- Mobile Navigation -->
            <div class="md:hidden grid grid-cols-2 gap-1 p-2">
                <button onclick="showTab('novo-servico')" id="tab-novo-servico-mobile" class="py-4 px-3 text-center font-semibold text-white bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg relative overflow-hidden group transition-all duration-300">
                    <div class="absolute inset-0 bg-gradient-to-r from-purple-600 to-blue-600 opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-lg"></div>
                    <span class="relative z-10 text-sm">
                        <i class="fas fa-user-plus block mb-1 text-lg"></i>Novo Serviço
                    </span>
                </button>
                <button onclick="showTab('clientes')" id="tab-clientes-mobile" class="py-4 px-3 text-center font-semibold text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-gray-700/50 rounded-lg transition-all duration-300 relative overflow-hidden group">
                    <div class="absolute inset-0 bg-gradient-to-r from-blue-600/10 to-purple-600/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-lg"></div>
                    <span class="relative z-10 text-sm">
                        <i class="fas fa-users block mb-1 text-lg"></i>Clientes
                    </span>
                </button>
                <button onclick="showTab('servicos')" id="tab-servicos-mobile" class="py-4 px-3 text-center font-semibold text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-gray-700/50 rounded-lg transition-all duration-300 relative overflow-hidden group">
                    <div class="absolute inset-0 bg-gradient-to-r from-blue-600/10 to-purple-600/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-lg"></div>
                    <span class="relative z-10 text-sm">
                        <i class="fas fa-clock block mb-1 text-lg"></i>Prazos
                    </span>
                </button>
                <button onclick="showTab('financeiro')" id="tab-financeiro-mobile" class="py-4 px-3 text-center font-semibold text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-gray-700/50 rounded-lg transition-all duration-300 relative overflow-hidden group">
                    <div class="absolute inset-0 bg-gradient-to-r from-blue-600/10 to-purple-600/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-lg"></div>
                    <span class="relative z-10 text-sm">
                        <i class="fas fa-dollar-sign block mb-1 text-lg"></i>Financeiro
                    </span>
                </button>
            </div>
        </div>

        <!-- Novo Serviço Tab -->
        <div id="novo-servico-tab" class="tab-content">
            <div class="grid xl:grid-cols-2 gap-4 lg:gap-8">
                <!-- Formulário de Cadastro Completo -->
                <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-2xl shadow-2xl border border-white/20 dark:border-gray-700/50 p-4 sm:p-6 lg:p-8 card-hover">
                    <h2 class="text-xl sm:text-2xl lg:text-3xl font-bold text-gray-800 dark:text-white mb-4 sm:mb-6 lg:mb-8">
                        <i class="fas fa-user-plus text-blue-600 dark:text-blue-400 mr-2 sm:mr-3"></i>
                        Novo Serviço
                    </h2>
                    
                    <form id="cliente-form" class="space-y-4">
                        <!-- Busca de Cliente Existente -->
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                            <h3 class="text-lg font-semibold text-blue-800 mb-3">
                                <i class="fas fa-search mr-2"></i>Buscar Cliente Existente
                            </h3>
                            <div class="flex gap-2">
                                <input type="text" id="busca-cliente-form" placeholder="Digite o nome do cliente ou falecido..." class="flex-1 px-4 py-2 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <button type="button" onclick="limparFormulario()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition duration-200">
                                    <i class="fas fa-plus mr-1"></i>Novo Cliente
                                </button>
                            </div>
                            <div id="resultados-busca" class="mt-3 max-h-40 overflow-y-auto"></div>
                        </div>

                        <!-- Dados do Cliente -->
                        <div class="border-b border-gray-200 dark:border-gray-600 pb-4">
                            <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-3">Dados do Cliente</h3>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Nome do Cliente</label>
                                <input type="text" id="nome" required class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Telefone</label>
                                <input type="tel" id="telefone" required placeholder="(11) 99999-9999" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400">
                            </div>

                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Quadra</label>
                                    <input type="text" id="quadra" required class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Lote</label>
                                    <input type="text" id="lote" required class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400">
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Nome do Falecido</label>
                                <input type="text" id="falecido" required class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400">
                            </div>

                            <div class="flex items-center">
                                <input type="checkbox" id="nota-fiscal" class="mr-2 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700">
                                <label for="nota-fiscal" class="text-sm font-medium text-gray-700 dark:text-gray-300">Solicita Nota Fiscal</label>
                            </div>

                            <!-- Campos para Nota Fiscal -->
                            <div id="campos-nf" class="hidden space-y-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg mt-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">CEP</label>
                                    <input type="text" id="cep" placeholder="00000-000" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400">
                                </div>
                                
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Logradouro</label>
                                        <input type="text" id="logradouro" readonly class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-100 dark:bg-gray-600 text-gray-900 dark:text-white">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Número</label>
                                        <input type="text" id="numero" class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400">
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Bairro</label>
                                        <input type="text" id="bairro" readonly class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-100 dark:bg-gray-600 text-gray-900 dark:text-white">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Cidade</label>
                                        <input type="text" id="cidade" readonly class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-100 dark:bg-gray-600 text-gray-900 dark:text-white">
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">CPF</label>
                                        <input type="text" id="cpf" placeholder="000.000.000-00" class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">RG</label>
                                        <input type="text" id="rg" class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Dados dos Serviços -->
                        <div class="border-b border-gray-200 dark:border-gray-600 pb-4">
                            <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-3">Dados dos Serviços</h3>
                            
                            <!-- Adicionar Serviço -->
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                                <h4 class="font-medium text-blue-800 mb-3">Adicionar Serviço</h4>
                                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
                                    <div class="sm:col-span-2 lg:col-span-1">
                                        <select id="novo-tipo-servico" class="w-full px-3 py-2 border border-blue-300 dark:border-blue-500 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                            <option value="">Selecione um serviço</option>
                                        </select>
                                    </div>
                                    <div>
                                        <input type="number" id="novo-valor-servico" placeholder="Valor (R$)" step="0.01" min="0" class="w-full px-3 py-2 border border-blue-300 dark:border-blue-500 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400" onkeypress="if(event.key==='Enter') adicionarServicoLista()">
                                    </div>
                                    <div class="flex gap-2 sm:col-span-2 lg:col-span-1">
                                        <button type="button" onclick="adicionarServicoLista()" class="flex-1 bg-blue-500 text-white px-3 py-2 rounded-lg hover:bg-blue-600 transition duration-200 text-sm">
                                            <i class="fas fa-plus mr-1"></i>Adicionar
                                        </button>
                                        <button type="button" onclick="adicionarNovoTipoServico()" class="bg-green-500 text-white px-3 py-2 rounded-lg hover:bg-green-600 transition duration-200">
                                            <i class="fas fa-cog"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Lista de Serviços Adicionados -->
                            <div id="lista-servicos-adicionados" class="mb-4">
                                <!-- Serviços serão inseridos aqui -->
                            </div>

                            <!-- Informações Gerais do Pedido -->
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Data do Serviço Contratado</label>
                                    <input type="date" id="data-inicio" required class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Prazo (dias)</label>
                                    <select id="prazo-dias" required class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                        <option value="">Selecione o prazo</option>
                                        <option value="1">1 dia</option>
                                        <option value="2">2 dias</option>
                                        <option value="3">3 dias</option>
                                        <option value="5">5 dias</option>
                                        <option value="7">7 dias</option>
                                        <option value="10">10 dias</option>
                                        <option value="15">15 dias</option>
                                        <option value="20">20 dias</option>
                                        <option value="30">30 dias</option>
                                        <option value="45">45 dias</option>
                                        <option value="60">60 dias</option>
                                        <option value="personalizado">Outro prazo (digitar)</option>
                                    </select>
                                </div>

                                <!-- Campo para prazo personalizado -->
                                <div id="prazo-personalizado" class="hidden col-span-1 sm:col-span-2">
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Digite o prazo em dias</label>
                                    <input type="number" id="prazo-personalizado-input" min="1" max="365" placeholder="Ex: 25" class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400">
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Data de Entrega (Calculada)</label>
                                <input type="text" id="data-entrega-calculada" readonly class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-100 dark:bg-gray-600 font-semibold text-gray-900 dark:text-white">
                            </div>

                            <!-- Valor Total Calculado -->
                            <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4">
                                <div class="flex justify-between items-center">
                                    <span class="text-lg font-semibold text-gray-700 dark:text-gray-300">Valor Total dos Serviços:</span>
                                    <span id="valor-total-servicos" class="text-2xl font-bold text-blue-600 dark:text-blue-400">R$ 0,00</span>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Status</label>
                                <select id="status-servico" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                    <option value="pendente">Pendente</option>
                                    <option value="em-andamento">Em Andamento</option>
                                    <option value="concluido">Concluído</option>
                                </select>
                            </div>
                        </div>

                        <!-- Controle de Pagamento -->
                        <div>
                            <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-3">Controle de Pagamento</h3>
                            
                            <!-- Opções de Pagamento -->
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Forma de Pagamento</label>
                                <div class="flex gap-4">
                                    <label class="flex items-center text-gray-700 dark:text-gray-300">
                                        <input type="radio" name="forma-pagamento" value="avista" checked class="mr-2 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700" onchange="toggleParcelamento()">
                                        <span>À Vista</span>
                                    </label>
                                    <label class="flex items-center text-gray-700 dark:text-gray-300">
                                        <input type="radio" name="forma-pagamento" value="parcelado" class="mr-2 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700" onchange="toggleParcelamento()">
                                        <span>Parcelado</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Pagamento à Vista -->
                            <div id="pagamento-avista" class="space-y-4">
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Valor Pago (R$)</label>
                                        <input type="number" id="valor-pago" step="0.01" min="0" value="0" class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Valor Restante</label>
                                        <input type="text" id="valor-restante" readonly class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-100 dark:bg-gray-600 font-semibold text-gray-900 dark:text-white">
                                    </div>
                                </div>
                            </div>

                            <!-- Pagamento Parcelado -->
                            <div id="pagamento-parcelado" class="hidden space-y-4">
                                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Número de Parcelas</label>
                                        <select id="numero-parcelas" class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white" onchange="calcularParcelas()">
                                            <option value="2">2x</option>
                                            <option value="3">3x</option>
                                            <option value="4">4x</option>
                                            <option value="5">5x</option>
                                            <option value="6">6x</option>
                                            <option value="10">10x</option>
                                            <option value="12">12x</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Valor da Parcela</label>
                                        <input type="text" id="valor-parcela" readonly class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-100 dark:bg-gray-600 font-semibold text-gray-900 dark:text-white">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Entrada (R$)</label>
                                        <input type="number" id="valor-entrada" step="0.01" min="0" value="0" class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400" onchange="calcularParcelas()">
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Data da Primeira Parcela</label>
                                    <input type="date" id="data-primeira-parcela" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white" onchange="calcularParcelas()">
                                </div>

                                <!-- Cronograma de Parcelas -->
                                <div id="cronograma-parcelas" class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4">
                                    <h4 class="font-medium text-gray-700 dark:text-gray-300 mb-3">Cronograma de Pagamento</h4>
                                    <div id="lista-parcelas" class="space-y-2">
                                        <!-- Parcelas serão inseridas aqui -->
                                    </div>
                                </div>
                            </div>

                            <div class="mt-3">
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Observações do Pagamento</label>
                                <textarea id="obs-pagamento" rows="2" placeholder="Ex: Entrada paga, restante em 30 dias..." class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400"></textarea>
                            </div>
                        </div>

                        <button type="submit" class="w-full bg-blue-600 dark:bg-blue-700 text-white py-3 px-6 rounded-lg hover:bg-blue-700 dark:hover:bg-blue-800 transition duration-200 font-medium">
                            <i class="fas fa-check mr-2"></i>Finalizar Pedido
                        </button>
                    </form>
                </div>

                <!-- Resumo Rápido -->
                <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-2xl shadow-2xl border border-white/20 dark:border-gray-700/50 p-4 sm:p-6 lg:p-8 card-hover">
                    <h2 class="text-xl sm:text-2xl lg:text-3xl font-bold text-gray-800 dark:text-white mb-4 sm:mb-6 lg:mb-8">
                        <i class="fas fa-chart-pie text-blue-600 dark:text-blue-400 mr-2 sm:mr-3"></i>
                        Resumo Rápido
                    </h2>
                    
                    <div class="space-y-6">
                        <div class="bg-gradient-to-r from-blue-500 to-blue-600 dark:from-blue-600 dark:to-blue-700 rounded-xl p-6 text-white shadow-lg card-hover">
                            <div class="flex justify-between items-center">
                                <div>
                                    <span class="text-blue-100 text-sm font-medium">Total de Clientes</span>
                                    <div id="total-clientes-resumo" class="text-3xl font-bold mt-1">0</div>
                                </div>
                                <div class="bg-white/20 rounded-full p-3">
                                    <i class="fas fa-users text-2xl"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-green-500 to-emerald-600 dark:from-green-600 dark:to-emerald-700 rounded-xl p-6 text-white shadow-lg card-hover">
                            <div class="flex justify-between items-center">
                                <div>
                                    <span class="text-green-100 text-sm font-medium">Serviços Ativos</span>
                                    <div id="servicos-ativos-resumo" class="text-3xl font-bold mt-1">0</div>
                                </div>
                                <div class="bg-white/20 rounded-full p-3">
                                    <i class="fas fa-cogs text-2xl"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-amber-500 to-orange-600 dark:from-amber-600 dark:to-orange-700 rounded-xl p-6 text-white shadow-lg card-hover">
                            <div class="flex justify-between items-center">
                                <div>
                                    <span class="text-amber-100 text-sm font-medium">Pagamentos Pendentes</span>
                                    <div id="pagamentos-pendentes-resumo" class="text-3xl font-bold mt-1">0</div>
                                </div>
                                <div class="bg-white/20 rounded-full p-3">
                                    <i class="fas fa-clock text-2xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-8 pt-6 border-t border-gray-200 dark:border-gray-600">
                        <p class="text-sm text-gray-600 dark:text-gray-300 text-center flex items-center justify-center">
                            <i class="fas fa-info-circle mr-2 text-blue-500"></i>
                            Use as abas acima para navegar entre as funcionalidades
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Clientes Tab -->
        <div id="clientes-tab" class="tab-content hidden">
            <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-2xl shadow-2xl border border-white/20 dark:border-gray-700/50 p-4 sm:p-6 lg:p-8 card-hover fade-in">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 sm:mb-6 gap-4">
                    <h2 class="text-xl sm:text-2xl lg:text-3xl font-bold text-gray-800 dark:text-white">
                        <i class="fas fa-users text-blue-600 dark:text-blue-400 mr-2 sm:mr-3"></i>
                        Gerenciar Clientes
                    </h2>
                    <div class="flex flex-col sm:flex-row gap-3 w-full sm:w-auto">
                        <input type="text" id="busca-cliente-geral" placeholder="Buscar cliente..." class="px-3 sm:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 w-full sm:w-auto">
                        <button onclick="voltarListaClientes()" id="btn-voltar-lista" class="hidden bg-gray-500 dark:bg-gray-600 text-white px-3 sm:px-4 py-2 rounded-lg hover:bg-gray-600 dark:hover:bg-gray-700 transition duration-200 text-sm">
                            <i class="fas fa-arrow-left mr-1 sm:mr-2"></i>Voltar à Lista
                        </button>
                    </div>
                </div>
                
                <!-- Lista de Clientes -->
                <div id="lista-clientes-geral" class="space-y-3">
                    <!-- Clientes serão inseridos aqui -->
                </div>
                
                <!-- Detalhes do Cliente -->
                <div id="detalhes-cliente" class="hidden">
                    <!-- Detalhes serão inseridos aqui -->
                </div>
            </div>
        </div>

        <!-- Serviços Tab -->
        <div id="servicos-tab" class="tab-content hidden">
            <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-2xl shadow-2xl border border-white/20 dark:border-gray-700/50 p-4 sm:p-6 lg:p-8 card-hover fade-in">
                <h2 class="text-xl sm:text-2xl lg:text-3xl font-bold text-gray-800 dark:text-white mb-4 sm:mb-6">
                    <i class="fas fa-tasks text-green-600 dark:text-green-400 mr-2 sm:mr-3"></i>
                    <span class="block sm:inline">Controle de Serviços e Prazos</span>
                    <span class="block sm:inline text-xs sm:text-sm font-normal text-gray-600 dark:text-gray-400 mt-1 sm:mt-0">(Ordenados por prioridade - prazo mais curto primeiro)</span>
                </h2>
                
                <div class="mb-4">
                    <select id="filtro-status" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                        <option value="">Todos os status</option>
                        <option value="pendente">Pendente</option>
                        <option value="em-andamento">Em Andamento</option>
                        <option value="concluido">Concluído</option>
                    </select>
                </div>

                <div id="lista-servicos" class="space-y-3">
                    <!-- Serviços serão inseridos aqui -->
                </div>
            </div>
        </div>

        <!-- Financeiro Tab -->
        <div id="financeiro-tab" class="tab-content hidden fade-in">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 lg:gap-8 mb-6 sm:mb-8">
                <!-- Cards de Resumo -->
                <div class="bg-gradient-to-r from-green-500 to-green-600 dark:from-green-600 dark:to-green-700 rounded-2xl shadow-2xl p-4 sm:p-6 text-white card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-100 text-sm sm:text-base">Total Recebido</p>
                            <p id="total-recebido" class="text-xl sm:text-2xl lg:text-3xl font-bold">R$ 0,00</p>
                        </div>
                        <div class="bg-white/20 rounded-full p-2 sm:p-3">
                            <i class="fas fa-money-bill-wave text-xl sm:text-2xl lg:text-3xl"></i>
                        </div>
                    </div>
                </div>

                <div onclick="mostrarClientesPendentes()" class="bg-gradient-to-r from-yellow-500 to-yellow-600 dark:from-yellow-600 dark:to-yellow-700 rounded-2xl shadow-2xl p-4 sm:p-6 text-white cursor-pointer hover:from-yellow-600 hover:to-yellow-700 dark:hover:from-yellow-700 dark:hover:to-yellow-800 transition-all duration-200 card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-yellow-100 text-sm sm:text-base">A Receber</p>
                            <p id="total-pendente" class="text-xl sm:text-2xl lg:text-3xl font-bold">R$ 0,00</p>
                            <p class="text-yellow-200 text-xs sm:text-sm mt-1">Clique para ver detalhes</p>
                        </div>
                        <div class="bg-white/20 rounded-full p-2 sm:p-3">
                            <i class="fas fa-clock text-xl sm:text-2xl lg:text-3xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-blue-500 to-blue-600 dark:from-blue-600 dark:to-blue-700 rounded-2xl shadow-2xl p-4 sm:p-6 text-white card-hover sm:col-span-2 lg:col-span-1">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-100 text-sm sm:text-base">Total Geral</p>
                            <p id="total-geral" class="text-xl sm:text-2xl lg:text-3xl font-bold">R$ 0,00</p>
                        </div>
                        <div class="bg-white/20 rounded-full p-2 sm:p-3">
                            <i class="fas fa-chart-line text-xl sm:text-2xl lg:text-3xl"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Análises e Comparativos -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 lg:gap-8 mb-6 sm:mb-8">
                <!-- Comparativo Semanal -->
                <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-2xl shadow-2xl border border-white/20 dark:border-gray-700/50 p-4 sm:p-6 card-hover">
                    <h3 class="text-lg sm:text-xl font-bold text-gray-800 dark:text-white mb-3 sm:mb-4">
                        <i class="fas fa-calendar-week text-blue-600 dark:text-blue-400 mr-2"></i>
                        Análise Semanal
                    </h3>
                    
                    <div class="space-y-4">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-medium text-blue-800">Esta Semana</span>
                                <span id="receita-semana-atual" class="text-xl font-bold text-blue-600">R$ 0,00</span>
                            </div>
                            <div class="text-sm text-blue-600">
                                <span id="servicos-semana-atual">0</span> serviços contratados
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-medium text-gray-700">Semana Anterior</span>
                                <span id="receita-semana-anterior" class="text-lg font-semibold text-gray-600">R$ 0,00</span>
                            </div>
                            <div class="text-sm text-gray-500">
                                <span id="servicos-semana-anterior">0</span> serviços contratados
                            </div>
                        </div>
                        
                        <div class="border-t border-gray-200 pt-3">
                            <div class="flex justify-between items-center">
                                <span class="font-medium text-gray-700">Variação Semanal:</span>
                                <div class="text-right">
                                    <span id="variacao-semanal-valor" class="font-bold">R$ 0,00</span>
                                    <div id="variacao-semanal-percentual" class="text-sm">0%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Comparativo Mensal -->
                <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-2xl shadow-2xl border border-white/20 dark:border-gray-700/50 p-4 sm:p-6 card-hover">
                    <h3 class="text-lg sm:text-xl font-bold text-gray-800 dark:text-white mb-3 sm:mb-4">
                        <i class="fas fa-calendar-alt text-green-600 dark:text-green-400 mr-2"></i>
                        Análise Mensal
                    </h3>
                    
                    <div class="space-y-4">
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-medium text-green-800">Este Mês</span>
                                <span id="receita-mes-atual" class="text-xl font-bold text-green-600">R$ 0,00</span>
                            </div>
                            <div class="text-sm text-green-600">
                                <span id="servicos-mes-atual">0</span> serviços contratados
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-medium text-gray-700">Mês Anterior</span>
                                <span id="receita-mes-anterior" class="text-lg font-semibold text-gray-600">R$ 0,00</span>
                            </div>
                            <div class="text-sm text-gray-500">
                                <span id="servicos-mes-anterior">0</span> serviços contratados
                            </div>
                        </div>
                        
                        <div class="border-t border-gray-200 pt-3">
                            <div class="flex justify-between items-center">
                                <span class="font-medium text-gray-700">Variação Mensal:</span>
                                <div class="text-right">
                                    <span id="variacao-mensal-valor" class="font-bold">R$ 0,00</span>
                                    <div id="variacao-mensal-percentual" class="text-sm">0%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gráfico Visual Simples -->
            <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-2xl shadow-2xl border border-white/20 dark:border-gray-700/50 p-6 mb-8 card-hover">
                <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4">
                    <i class="fas fa-chart-bar text-purple-600 dark:text-purple-400 mr-2"></i>
                    Evolução dos Últimos 6 Meses
                </h3>
                
                <div id="grafico-evolucao" class="space-y-3">
                    <!-- Gráfico será inserido aqui -->
                </div>
            </div>

            <!-- Estatísticas Detalhadas -->
            <div class="grid lg:grid-cols-3 gap-6 mb-8">
                <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-2xl shadow-2xl border border-white/20 dark:border-gray-700/50 p-6 card-hover">
                    <h4 class="text-lg font-semibold text-gray-800 dark:text-white mb-3">
                        <i class="fas fa-trophy text-yellow-500 dark:text-yellow-400 mr-2"></i>
                        Serviços Mais Vendidos
                    </h4>
                    <div id="servicos-populares" class="space-y-2">
                        <!-- Lista será inserida aqui -->
                    </div>
                </div>

                <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-2xl shadow-2xl border border-white/20 dark:border-gray-700/50 p-6 card-hover">
                    <h4 class="text-lg font-semibold text-gray-800 dark:text-white mb-3">
                        <i class="fas fa-clock text-blue-500 dark:text-blue-400 mr-2"></i>
                        Tempo Médio de Conclusão
                    </h4>
                    <div class="text-center">
                        <div id="tempo-medio-conclusao" class="text-3xl font-bold text-blue-600 dark:text-blue-400">0</div>
                        <div class="text-sm text-gray-500 dark:text-gray-400">dias em média</div>
                    </div>
                </div>

                <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-2xl shadow-2xl border border-white/20 dark:border-gray-700/50 p-6 card-hover">
                    <h4 class="text-lg font-semibold text-gray-800 dark:text-white mb-3">
                        <i class="fas fa-percentage text-green-500 dark:text-green-400 mr-2"></i>
                        Taxa de Pagamento
                    </h4>
                    <div class="text-center">
                        <div id="taxa-pagamento" class="text-3xl font-bold text-green-600 dark:text-green-400">0%</div>
                        <div class="text-sm text-gray-500 dark:text-gray-400">dos valores recebidos</div>
                    </div>
                </div>
            </div>

            <!-- Controle de Pagamentos -->
            <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-2xl shadow-2xl border border-white/20 dark:border-gray-700/50 p-6 card-hover">
                <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-6">
                    <i class="fas fa-credit-card text-purple-600 dark:text-purple-400 mr-2"></i>
                    Controle de Pagamentos
                </h2>
                
                <div id="lista-pagamentos" class="space-y-3">
                    <!-- Pagamentos serão inseridos aqui -->
                </div>
            </div>
        </div>
    </div>

    <script>
    // Referências às "tabelas" (coleções) no banco de dados Firestore
    const clientesCollection = db.collection('clientes');
    const servicosCollection = db.collection('servicos');
    const configCollection = db.collection('config');

    // Dados em memória (serão preenchidos pelo banco de dados)
    let clientes = [];
    let servicos = [];
    let tiposServico = [];
    let servicosTemporarios = []; // Lista de serviços sendo adicionados no formulário

    // Função para alternar modo escuro
    function toggleDarkMode() {
        const html = document.documentElement;
        const themeIcon = document.getElementById('theme-icon');
        
        if (html.classList.contains('dark')) {
            html.classList.remove('dark');
            themeIcon.className = 'fas fa-moon text-lg';
            localStorage.setItem('darkMode', 'false'); // Preferência de tema pode continuar local
        } else {
            html.classList.add('dark');
            themeIcon.className = 'fas fa-sun text-lg';
            localStorage.setItem('darkMode', 'true');
        }
    }

    // Carregar preferência de tema
    function loadThemePreference() {
        const darkMode = localStorage.getItem('darkMode');
        const themeIcon = document.getElementById('theme-icon');
        
        if (darkMode === 'true') {
            document.documentElement.classList.add('dark');
            if (themeIcon) themeIcon.className = 'fas fa-sun text-lg';
        } else {
            document.documentElement.classList.remove('dark');
            if (themeIcon) themeIcon.className = 'fas fa-moon text-lg';
        }
    }

    // ######### NOVO: FUNÇÕES DE BANCO DE DADOS #########

    // Carrega todos os dados do Firestore quando a página é aberta
    async function carregarDadosDoFirestore() {
        try {
            // Carregar clientes
            const snapshotClientes = await clientesCollection.get();
            clientes = snapshotClientes.docs.map(doc => ({ id: doc.id, ...doc.data() }));

            // Carregar serviços
            const snapshotServicos = await servicosCollection.get();
            servicos = snapshotServicos.docs.map(doc => ({ id: doc.id, ...doc.data() }));

            // Carregar tipos de serviço (ou inicializar se não existirem)
            const docTipos = await configCollection.doc('tiposServico').get();
            if (docTipos.exists && docTipos.data().tipos) {
                tiposServico = docTipos.data().tipos;
            } else {
                // Se não existir no banco, cria uma lista padrão
                await inicializarTiposServico();
            }

            // Após carregar tudo, atualiza a interface
            console.log("Dados carregados do Firestore com sucesso!");
            atualizarTodaInterface();

        } catch (error) {
            console.error("Erro ao carregar dados do Firestore: ", error);
            alert("Não foi possível conectar ao banco de dados. Verifique sua conexão e as configurações do Firebase.");
        }
    }

    // Salva os tipos de serviço no banco
    async function salvarTiposServicoNoFirestore() {
        try {
            await configCollection.doc('tiposServico').set({ tipos: tiposServico });
        } catch (error) {
            console.error("Erro ao salvar tipos de serviço: ", error);
        }
    }

    // ######### FIM DAS FUNÇÕES DE BANCO DE DADOS #########


    // Inicialização
    document.addEventListener('DOMContentLoaded', function() {
        loadThemePreference();
        
        // Event listeners
        document.getElementById('cliente-form').addEventListener('submit', cadastrarServico);
        document.getElementById('nota-fiscal').addEventListener('change', toggleNotaFiscal);
        document.getElementById('cep').addEventListener('blur', buscarCEP);
        document.getElementById('busca-cliente-geral').addEventListener('input', filtrarClientesGeral);
        document.getElementById('busca-cliente-form').addEventListener('input', buscarClienteExistente);
        document.getElementById('filtro-status').addEventListener('change', filtrarServicos);
        document.getElementById('valor-pago').addEventListener('input', calcularValorRestante);
        document.getElementById('data-inicio').addEventListener('change', calcularDataEntrega);
        document.getElementById('prazo-dias').addEventListener('change', function() {
            togglePrazoPersonalizado();
            calcularDataEntrega();
        });
        document.getElementById('prazo-personalizado-input').addEventListener('input', calcularDataEntrega);

        aplicarMascaras();
        
        // NOVO: Carrega os dados do banco de dados online
        carregarDadosDoFirestore();
    });

    // Função para atualizar toda a interface após carregar os dados
    function atualizarTodaInterface() {
        atualizarTiposServicoSelect();
        atualizarListaServicos();
        atualizarFinanceiro();
        atualizarResumoRapido();
        atualizarListaClientesGeral(); // Adicionado para carregar na aba clientes
    }

    function showTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
        document.querySelectorAll('[id^="tab-"]').forEach(btn => {
            btn.classList.remove('text-white', 'bg-gradient-to-r', 'from-blue-600', 'to-purple-600');
            btn.classList.add('text-gray-600', 'dark:text-gray-300');
            btn.style.background = '';
        });
        document.getElementById(tabName + '-tab').classList.remove('hidden');
        const activeBtn = document.getElementById('tab-' + tabName);
        activeBtn.classList.remove('text-gray-600', 'dark:text-gray-300');
        activeBtn.classList.add('text-white', 'bg-gradient-to-r', 'from-blue-600', 'to-purple-600');
        
        if (tabName === 'clientes') {
            atualizarListaClientesGeral();
            voltarListaClientes();
        } else if (tabName === 'novo-servico') {
            atualizarResumoRapido();
        }
    }

    // Função principal de cadastro - agora assíncrona para salvar no DB
    async function cadastrarServico(e) {
        e.preventDefault();
        
        if (servicosTemporarios.length === 0) {
            alert('Adicione pelo menos um serviço antes de finalizar o pedido!');
            return;
        }

        const valorTotal = calcularValorTotalServicos();
        const formaPagamento = document.querySelector('input[name="forma-pagamento"]:checked').value;
        let valorPago = 0;
        let parcelas = [];
        
        if (formaPagamento === 'avista') {
            valorPago = parseFloat(document.getElementById('valor-pago').value) || 0;
        } else {
            valorPago = parseFloat(document.getElementById('valor-entrada').value) || 0;
            const numeroParcelas = parseInt(document.getElementById('numero-parcelas').value);
            const valorParcelar = valorTotal - valorPago;
            const valorParcela = valorParcelar / numeroParcelas;
            const dataPrimeiraParcela = document.getElementById('data-primeira-parcela').value;
            if (dataPrimeiraParcela) {
                const dataBase = new Date(dataPrimeiraParcela);
                for (let i = 1; i <= numeroParcelas; i++) {
                    const dataParcela = new Date(dataBase);
                    dataParcela.setMonth(dataParcela.getMonth() + (i - 1));
                    parcelas.push({
                        numero: i, valor: valorParcela,
                        dataVencimento: dataParcela.toISOString().split('T')[0], pago: false
                    });
                }
            }
        }
        
        let clienteId = document.getElementById('cliente-form').dataset.clienteId;
        let clienteData = {
            nome: document.getElementById('nome').value,
            telefone: document.getElementById('telefone').value,
            quadra: document.getElementById('quadra').value,
            lote: document.getElementById('lote').value,
            falecido: document.getElementById('falecido').value,
            notaFiscal: document.getElementById('nota-fiscal').checked,
            endereco: document.getElementById('nota-fiscal').checked ? {
                cep: document.getElementById('cep').value, logradouro: document.getElementById('logradouro').value,
                numero: document.getElementById('numero').value, bairro: document.getElementById('bairro').value,
                cidade: document.getElementById('cidade').value, cpf: document.getElementById('cpf').value,
                rg: document.getElementById('rg').value
            } : null
        };
        
        try {
            if (clienteId) {
                // Atualiza cliente existente no Firestore
                await clientesCollection.doc(clienteId).update(clienteData);
            } else {
                // Adiciona novo cliente ao Firestore e pega o ID
                const docRef = await clientesCollection.add(clienteData);
                clienteId = docRef.id;
            }

            const dataInicio = new Date(document.getElementById('data-inicio').value);
            let prazoDias = (document.getElementById('prazo-dias').value === 'personalizado')
                ? parseInt(document.getElementById('prazo-personalizado-input').value)
                : parseInt(document.getElementById('prazo-dias').value);
            
            const dataEntrega = new Date(dataInicio);
            dataEntrega.setDate(dataEntrega.getDate() + prazoDias);

            const servicoData = {
                clienteId: clienteId,
                descricao: servicosTemporarios.map(s => s.tipo).join(', '),
                detalhesServicos: servicosTemporarios.map(s => ({ tipo: s.tipo, valor: s.valor })),
                dataInicio: document.getElementById('data-inicio').value,
                prazoDias: prazoDias,
                prazoEntrega: dataEntrega.toISOString().split('T')[0],
                valorTotal: valorTotal,
                valorPago: valorPago,
                valorRestante: valorTotal - valorPago,
                status: document.getElementById('status-servico').value,
                observacoesPagamento: document.getElementById('obs-pagamento').value,
                formaPagamento: formaPagamento,
                parcelas: parcelas,
                pago: valorPago >= valorTotal
            };

            // Adiciona o novo serviço ao Firestore
            await servicosCollection.add(servicoData);

            alert(`Pedido cadastrado com sucesso!`);
            limparFormulario();
            
            // Recarrega os dados do banco para garantir consistência
            await carregarDadosDoFirestore();

        } catch (error) {
            console.error("Erro ao cadastrar serviço: ", error);
            alert("Ocorreu um erro ao salvar o pedido. Tente novamente.");
        }
    }
    
    // Função para adicionar um novo tipo de serviço (agora salva no DB)
    async function adicionarNovoTipoServico() {
        const novoTipo = prompt('Digite o nome do novo tipo de serviço:');
        
        if (novoTipo && novoTipo.trim()) {
            const tipoLimpo = novoTipo.trim();
            if (!tiposServico.includes(tipoLimpo)) {
                tiposServico.push(tipoLimpo);
                await salvarTiposServicoNoFirestore(); // Salva no banco
                atualizarTiposServicoSelect();
                alert('Novo tipo de serviço adicionado com sucesso!');
            } else {
                alert('Este tipo de serviço já existe!');
            }
        }
    }

    // Inicializa a lista de serviços padrão (se não existir no DB)
    async function inicializarTiposServico() {
        const tiposPadrao = [
            'Limpeza de Túmulo', 'Construção de Túmulo', 'Reforma de Túmulo',
            'Colocação de Placa', 'Jardinagem', 'Pintura', 'Manutenção Geral', 'Massa Batida'
        ];
        tiposServico = [...new Set([...tiposServico, ...tiposPadrao])];
        await salvarTiposServicoNoFirestore();
    }
    
    // Altera o status de um serviço (agora salva no DB)
    async function confirmarAlteracaoStatus(servicoId, novoStatus) {
        try {
            await servicosCollection.doc(servicoId).update({ status: novoStatus });
            const servico = servicos.find(s => s.id === servicoId);
            if (servico) servico.status = novoStatus; // Atualiza localmente também

            atualizarListaServicos();
            atualizarFinanceiro();
            atualizarResumoRapido();
            
            document.querySelector('.fixed').remove();
            alert(`✅ Status alterado com sucesso!`);
        } catch (error) {
            console.error("Erro ao alterar status: ", error);
            alert("Falha ao alterar o status.");
        }
    }
    
    // Exclui um cliente e seus serviços (agora do DB)
    async function excluirCliente(clienteId) {
        const cliente = clientes.find(c => c.id === clienteId);
        if (!cliente) return;

        const confirmacaoFinal = prompt(`Para confirmar a exclusão PERMANENTE do cliente "${cliente.nome}" e de TODOS os seus serviços associados, digite exatamente: EXCLUIR`);
        
        if (confirmacaoFinal === "EXCLUIR") {
            try {
                // Deleta o cliente
                await clientesCollection.doc(clienteId).delete();

                // Busca e deleta todos os serviços associados
                const servicosDoCliente = await servicosCollection.where('clienteId', '==', clienteId).get();
                const deletePromises = [];
                servicosDoCliente.forEach(doc => {
                    deletePromises.push(servicosCollection.doc(doc.id).delete());
                });
                await Promise.all(deletePromises);

                alert(`Cliente "${cliente.nome}" e seus serviços foram excluídos permanentemente.`);
                
                // Recarrega tudo do banco
                await carregarDadosDoFirestore();
                voltarListaClientes();

            } catch (error) {
                console.error("Erro ao excluir cliente: ", error);
                alert("Falha ao excluir o cliente.");
            }
        } else {
            alert('❌ Exclusão cancelada.');
        }
    }
    
    // Cancela/Exclui um serviço específico (agora do DB)
    async function cancelarServico(servicoId) {
        const servico = servicos.find(s => s.id === servicoId);
        if (!servico) return;

        const confirmacao = confirm(`Tem certeza que deseja cancelar este serviço?\n\n${servico.descricao}\n\nEsta ação não pode ser desfeita!`);
        if (confirmacao) {
            try {
                await servicosCollection.doc(servicoId).delete();
                alert('Serviço cancelado com sucesso!');
                // Recarrega tudo do banco
                await carregarDadosDoFirestore();
            } catch (error) {
                console.error("Erro ao cancelar serviço: ", error);
                alert("Falha ao cancelar o serviço.");
            }
        }
    }
    
    // Edita um cliente (agora no DB)
    async function salvarEdicaoCliente(clienteId) {
        const cliente = clientes.find(c => c.id === clienteId);
        if(!cliente) return;
        
        const clienteData = {
            nome: document.getElementById('edit-nome').value,
            telefone: document.getElementById('edit-telefone').value,
            quadra: document.getElementById('edit-quadra').value,
            lote: document.getElementById('edit-lote').value,
            falecido: document.getElementById('edit-falecido').value,
        };

        try {
            await clientesCollection.doc(clienteId).update(clienteData);
            alert('Cliente atualizado com sucesso!');
            document.querySelector('.fixed').remove();
            await carregarDadosDoFirestore(); // Recarrega para mostrar mudanças
        } catch (error) {
            console.error("Erro ao editar cliente: ", error);
            alert("Falha ao atualizar o cliente.");
        }
    }

    // Adiciona um pagamento (agora no DB)
    async function adicionarPagamento(servicoId) {
        const servico = servicos.find(s => s.id === servicoId);
        if (!servico || servico.valorRestante <= 0) {
            alert('Este serviço não possui pagamentos pendentes.');
            return;
        }

        const valorPagamento = prompt(`Valor restante: R$ ${servico.valorRestante.toFixed(2)}\n\nDigite o valor do pagamento:`);
        
        if (valorPagamento && !isNaN(valorPagamento)) {
            const valor = parseFloat(valorPagamento);
            if (valor > 0 && valor <= servico.valorRestante) {
                const novoValorPago = servico.valorPago + valor;
                const novoValorRestante = servico.valorTotal - novoValorPago;

                try {
                    await servicosCollection.doc(servicoId).update({
                        valorPago: novoValorPago,
                        valorRestante: novoValorRestante,
                        pago: novoValorRestante <= 0
                    });

                    alert(`Pagamento registrado com sucesso!`);
                    await carregarDadosDoFirestore();

                } catch (error) {
                    console.error("Erro ao adicionar pagamento: ", error);
                    alert("Falha ao registrar pagamento.");
                }
            } else {
                alert('Valor inválido!');
            }
        }
    }


    // ====== O RESTANTE DO CÓDIGO (LÓGICA DA INTERFACE) PERMANECE PRATICAMENTE O MESMO ======
    // As funções abaixo apenas LEEM os dados das variáveis locais (clientes, servicos),
    // que agora são preenchidas pelo Firestore.

    function atualizarTiposServicoSelect() {
        const select = document.getElementById('novo-tipo-servico');
        if (!select) return;
        select.innerHTML = '<option value="">Selecione um serviço</option>' +
            tiposServico.map(tipo => `<option value="${tipo}">${tipo}</option>`).join('');
        select.addEventListener('change', function() {
            if (this.value) document.getElementById('novo-valor-servico').focus();
        });
    }
    
    function limparFormulario() {
        document.getElementById('cliente-form').reset();
        document.getElementById('cliente-form').removeAttribute('data-cliente-id');
        document.getElementById('campos-nf').classList.add('hidden');
        document.getElementById('prazo-personalizado').classList.add('hidden');
        document.getElementById('pagamento-parcelado').classList.add('hidden');
        document.getElementById('pagamento-avista').classList.remove('hidden');
        document.getElementById('valor-restante').value = '';
        document.getElementById('data-entrega-calculada').value = '';
        document.getElementById('busca-cliente-form').value = '';
        document.getElementById('busca-cliente-form').placeholder = 'Digite o nome do cliente ou falecido...';
        document.getElementById('resultados-busca').innerHTML = '';
        servicosTemporarios = [];
        atualizarListaServicosAdicionados();
        atualizarValorTotalServicos();
        document.querySelector('input[name="forma-pagamento"][value="avista"]').checked = true;
    }

    // (Cole aqui o restante das suas funções de manipulação de interface,
    // como toggleNotaFiscal, calcularValorRestante, etc.
    // O código abaixo é o seu código original que não precisa de muitas alterações)

    function toggleNotaFiscal(){const checkbox=document.getElementById("nota-fiscal"),campos=document.getElementById("campos-nf");checkbox.checked?campos.classList.remove("hidden"):campos.classList.add("hidden")}function calcularValorRestante(){const valorTotal=calcularValorTotalServicos(),valorPago=parseFloat(document.getElementById("valor-pago").value)||0,valorRestante=valorTotal-valorPago;document.getElementById("valor-restante").value=`R$ ${valorRestante.toFixed(2).replace(".",",")}`}function calcularValorTotalServicos(){return servicosTemporarios.reduce((total,servico)=>total+servico.valor,0)}function atualizarValorTotalServicos(){const total=calcularValorTotalServicos();document.getElementById("valor-total-servicos").textContent=`R$ ${total.toFixed(2).replace(".",",")}`;calcularValorRestante();calcularParcelas()}function adicionarServicoLista(){const tipoServico=document.getElementById("novo-tipo-servico").value,valorServico=parseFloat(document.getElementById("novo-valor-servico").value);if(!tipoServico)return alert("Selecione um tipo de serviço!"),void document.getElementById("novo-tipo-servico").focus();if(!valorServico||valorServico<=0)return alert("Digite um valor válido para o serviço!"),void document.getElementById("novo-valor-servico").focus();const servicoExistente=servicosTemporarios.find(s=>s.tipo===tipoServico);if(servicoExistente){const confirmar=confirm(`O serviço "${tipoServico}" já foi adicionado com valor R$ ${servicoExistente.valor.toFixed(2).replace(".",",")}.\n\nDeseja adicionar novamente com valor R$ ${valorServico.toFixed(2).replace(".",",")}?`);if(!confirmar)return}servicosTemporarios.push({id:Date.now(),tipo:tipoServico,valor:valorServico});document.getElementById("novo-tipo-servico").value="";document.getElementById("novo-valor-servico").value="";document.getElementById("novo-tipo-servico").focus();atualizarListaServicosAdicionados();atualizarValorTotalServicos();const botaoAdicionar=event.target,textoOriginal=botaoAdicionar.innerHTML;botaoAdicionar.innerHTML='<i class="fas fa-check mr-1"></i>Adicionado!';botaoAdicionar.classList.add("bg-green-600");setTimeout(()=>{botaoAdicionar.innerHTML=textoOriginal;botaoAdicionar.classList.remove("bg-green-600")},1e3)}function atualizarListaServicosAdicionados(){const lista=document.getElementById("lista-servicos-adicionados");if(0===servicosTemporarios.length)return void(lista.innerHTML='<p class="text-gray-500 text-sm italic">Nenhum serviço adicionado ainda. Selecione um tipo de serviço acima para começar.</p>');lista.innerHTML=`
                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                    <h4 class="font-medium text-green-800 mb-3">
                        <i class="fas fa-check-circle mr-2"></i>Serviços Adicionados (${servicosTemporarios.length})
                    </h4>
                    <div class="space-y-2">
                        ${servicosTemporarios.map((servico,index)=>`
                            <div class="flex justify-between items-center bg-white p-3 rounded border hover:bg-gray-50 transition-colors">
                                <div class="flex items-center">
                                    <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full mr-3">${index+1}</span>
                                    <span class="font-medium text-gray-800">${servico.tipo}</span>
                                </div>
                                <div class="flex items-center gap-3">
                                    <span class="font-semibold text-green-600">R$ ${servico.valor.toFixed(2).replace(".",",")}</span>
                                    <button onclick="removerServicoLista(${servico.id})" class="text-red-500 hover:text-red-700 hover:bg-red-50 p-1 rounded transition-colors" title="Remover serviço">
                                        <i class="fas fa-trash text-sm"></i>
                                    </button>
                                </div>
                            </div>
                        `).join("")}
                    </div>
                </div>
            `}function removerServicoLista(servicoId){servicosTemporarios=servicosTemporarios.filter(s=>s.id!==servicoId);atualizarListaServicosAdicionados();atualizarValorTotalServicos()}function toggleParcelamento(){const formaPagamento=document.querySelector('input[name="forma-pagamento"]:checked').value,pagamentoAvista=document.getElementById("pagamento-avista"),pagamentoParcelado=document.getElementById("pagamento-parcelado");"avista"===formaPagamento?(pagamentoAvista.classList.remove("hidden"),pagamentoParcelado.classList.add("hidden")):(pagamentoAvista.classList.add("hidden"),pagamentoParcelado.classList.remove("hidden"),calcularParcelas())}function calcularParcelas(){const valorTotal=calcularValorTotalServicos(),numeroParcelas=parseInt(document.getElementById("numero-parcelas").value),valorEntrada=parseFloat(document.getElementById("valor-entrada").value)||0,dataPrimeiraParcela=document.getElementById("data-primeira-parcela").value;if(0===valorTotal)return;const valorParcelar=valorTotal-valorEntrada,valorParcela=valorParcelar/numeroParcelas;document.getElementById("valor-parcela").value=`R$ ${valorParcela.toFixed(2).replace(".",",")}`;dataPrimeiraParcela&&gerarCronogramaParcelas(numeroParcelas,valorParcela,valorEntrada,dataPrimeiraParcela)}function gerarCronogramaParcelas(numeroParcelas,valorParcela,valorEntrada,dataPrimeira){const listaParcelas=document.getElementById("lista-parcelas");let html="";if(valorEntrada>0)html+=`
                    <div class="flex justify-between items-center p-2 bg-blue-100 rounded">
                        <span class="font-medium">Entrada</span>
                        <span class="font-semibold text-blue-600">R$ ${valorEntrada.toFixed(2).replace(".",",")}</span>
                    </div>
                `;const dataBase=new Date(dataPrimeira);for(let i=1;i<=numeroParcelas;i++){const dataParcela=new Date(dataBase);dataParcela.setMonth(dataParcela.getMonth()+i-1);html+=`
                    <div class="flex justify-between items-center p-2 bg-white border rounded">
                        <span>${i}ª Parcela - ${dataParcela.toLocaleDateString("pt-BR")}</span>
                        <span class="font-semibold">R$ ${valorParcela.toFixed(2).replace(".",",")}</span>
                    </div>
                `}listaParcelas.innerHTML=html}function togglePrazoPersonalizado(){const select=document.getElementById("prazo-dias"),campoPersonalizado=document.getElementById("prazo-personalizado");"personalizado"===select.value?(campoPersonalizado.classList.remove("hidden"),document.getElementById("prazo-personalizado-input").required=!0):(campoPersonalizado.classList.add("hidden"),document.getElementById("prazo-personalizado-input").required=!1,document.getElementById("prazo-personalizado-input").value="")}function calcularDataEntrega(){const dataInicio=document.getElementById("data-inicio").value;let prazoDias;"personalizado"===document.getElementById("prazo-dias").value?prazoDias=parseInt(document.getElementById("prazo-personalizado-input").value):prazoDias=parseInt(document.getElementById("prazo-dias").value);if(dataInicio&&prazoDias){const dataInicioObj=new Date(dataInicio),dataEntrega=new Date(dataInicioObj);dataEntrega.setDate(dataEntrega.getDate()+prazoDias);const dataFormatada=dataEntrega.toLocaleDateString("pt-BR");document.getElementById("data-entrega-calculada").value=dataFormatada}else document.getElementById("data-entrega-calculada").value=""}async function buscarCEP(){const cep=document.getElementById("cep").value.replace(/\D/g,"");if(8===cep.length)try{const response=await fetch(`https://viacep.com.br/ws/${cep}/json/`),data=await response.json();data.erro?alert("CEP não encontrado!"):(document.getElementById("logradouro").value=data.logradouro,document.getElementById("bairro").value=data.bairro,document.getElementById("cidade").value=data.localidade+" - "+data.uf)}catch(error){console.log("Erro ao buscar CEP:",error)}}function aplicarMascaras(){document.getElementById("telefone").addEventListener("input",function(e){let value=e.target.value.replace(/\D/g,"");value=value.replace(/(\d{2})(\d)/,"($1) $2"),value=value.replace(/(\d{5})(\d)/,"$1-$2"),e.target.value=value});document.getElementById("cep").addEventListener("input",function(e){let value=e.target.value.replace(/\D/g,"");value=value.replace(/(\d{5})(\d)/,"$1-$2"),e.target.value=value});document.getElementById("cpf").addEventListener("input",function(e){let value=e.target.value.replace(/\D/g,"");value=value.replace(/(\d{3})(\d)/,"$1.$2"),value=value.replace(/(\d{3})(\d)/,"$1.$2"),value=value.replace(/(\d{3})(\d{1,2})$/,"$1-$2"),e.target.value=value})}function atualizarListaClientesGeral(){const lista=document.getElementById("lista-clientes-geral"),busca=document.getElementById("busca-cliente-geral").value.toLowerCase(),clientesFiltrados=clientes.filter(cliente=>cliente.nome.toLowerCase().includes(busca)||cliente.falecido.toLowerCase().includes(busca)||cliente.telefone.includes(busca));if(0===clientesFiltrados.length)return void(lista.innerHTML=`
                    <div class="text-center py-12">
                        <i class="fas fa-users text-6xl text-gray-300 mb-4"></i>
                        <h3 class="text-xl font-semibold text-gray-600 mb-2">
                            ${0===clientes.length?"Nenhum cliente cadastrado":"Nenhum cliente encontrado"}
                        </h3>
                        <p class="text-gray-500">
                            ${0===clientes.length?'Cadastre o primeiro cliente na aba "Novo Serviço"':"Tente ajustar os termos da busca"}
                        </p>
                    </div>
                `);lista.innerHTML=clientesFiltrados.map(cliente=>{const servicosCliente=servicos.filter(s=>s.clienteId===cliente.id),totalServicos=servicosCliente.length,servicosAtivos=servicosCliente.filter(s=>"concluido"!==s.status).length,valorTotal=servicosCliente.reduce((sum,s)=>sum+s.valorTotal,0),valorPendente=servicosCliente.reduce((sum,s)=>sum+s.valorRestante,0);return`
                    <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 cursor-pointer transition-colors" onclick="mostrarDetalhesCliente('${cliente.id}')">
                        <div class="flex justify-between items-start">
                             <div class="flex-1"><h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-1">${cliente.nome}</h3><p class="text-sm text-gray-600 dark:text-gray-300 mb-1"><i class="fas fa-user-circle mr-1"></i>Falecido: ${cliente.falecido}</p><p class="text-sm text-gray-600 dark:text-gray-300 mb-2"><i class="fas fa-map-marker-alt mr-1"></i>Quadra: ${cliente.quadra} | Lote: ${cliente.lote}</p><p class="text-sm text-gray-600 dark:text-gray-300"><i class="fas fa-phone mr-1"></i>${cliente.telefone}</p> ${cliente.notaFiscal?'<span class="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full mt-2">Nota Fiscal</span>':""}</div>
                            <div class="text-right">
                                <div class="grid grid-cols-2 gap-3 mb-3">
                                    <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-2 text-center"><div class="text-lg font-bold text-blue-600 dark:text-blue-400">${totalServicos}</div><div class="text-xs text-blue-600 dark:text-blue-400">Serviços</div></div>
                                    <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-2 text-center"><div class="text-lg font-bold text-yellow-600 dark:text-yellow-400">${servicosAtivos}</div><div class="text-xs text-yellow-600 dark:text-yellow-400">Ativos</div></div>
                                </div>
                                <div class="text-right"><p class="text-sm font-semibold text-gray-700 dark:text-gray-200">Total: R$ ${valorTotal.toFixed(2).replace(".",",")}</p> ${valorPendente>0?`<p class="text-sm font-medium text-red-600 dark:text-red-400">Pendente: R$ ${valorPendente.toFixed(2).replace(".",",")}</p>`:`<p class="text-sm font-medium text-green-600 dark:text-green-400">Tudo Pago</p>`}</div>
                            </div>
                        </div>
                    </div>
                `}).join("")}function atualizarResumoRapido(){const totalClientes=clientes.length,servicosAtivos=servicos.filter(s=>"concluido"!==s.status).length,pagamentosPendentes=servicos.filter(s=>s.valorRestante>0).length;document.getElementById("total-clientes-resumo").textContent=totalClientes;document.getElementById("servicos-ativos-resumo").textContent=servicosAtivos;document.getElementById("pagamentos-pendentes-resumo").textContent=pagamentosPendentes}function atualizarListaServicos(){const lista=document.getElementById("lista-servicos"),filtroStatus=document.getElementById("filtro-status").value,servicosFiltrados=servicos.filter(servico=>!filtroStatus||servico.status===filtroStatus).sort((a,b)=>{const dataA=new Date(a.prazoEntrega),dataB=new Date(b.prazoEntrega);return dataA-dataB});lista.innerHTML=servicosFiltrados.map(servico=>{const cliente=clientes.find(c=>c.id===servico.clienteId),hoje=new Date,prazo=new Date(servico.prazoEntrega),diasRestantes=Math.ceil((prazo-hoje)/864e5);let corPrazo="text-green-600 dark:text-green-400";diasRestantes<0?corPrazo="text-red-600 dark:text-red-400":diasRestantes<=3&&(corPrazo="text-yellow-600 dark:text-yellow-400");let corStatus="bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300";"concluido"===servico.status?corStatus="bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300":"em-andamento"===servico.status&&(corStatus="bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300");return`
                    <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50">
                        <div class="flex justify-between items-start mb-2"><h3 class="font-semibold text-gray-800 dark:text-white">${cliente?cliente.nome:"Cliente não encontrado"}</h3><span class="inline-block ${corStatus} text-xs px-2 py-1 rounded-full">${servico.status.replace("-"," ").toUpperCase()}</span></div>
                        <p class="text-sm text-gray-600 dark:text-gray-300 mb-2">${servico.descricao}</p>
                        <div class="text-xs text-gray-500 dark:text-gray-400 mb-2">Prazo: ${servico.prazoDias} dias | Entrega: ${new Date(servico.prazoEntrega).toLocaleDateString("pt-BR")}</div>
                        <div class="grid grid-cols-2 gap-4 mb-3"><div><span class="${corPrazo} font-medium text-sm">${diasRestantes>=0?`${diasRestantes} dias restantes`:`${Math.abs(diasRestantes)} dias em atraso`}</span></div><div class="text-right"><p class="text-sm font-semibold">Total: R$ ${servico.valorTotal.toFixed(2).replace(".",",")}</p><p class="text-sm">Pago: R$ ${servico.valorPago.toFixed(2).replace(".",",")}</p><p class="text-sm ${servico.valorRestante>0?"text-red-600 dark:text-red-400":"text-green-600 dark:text-green-400"} font-medium">${servico.valorRestante>0?`Falta: R$ ${servico.valorRestante.toFixed(2).replace(".",",")}`:"Pago Completo"}</p></div></div>
                        ${servico.observacoesPagamento?`<div class="bg-gray-50 dark:bg-gray-900/20 p-2 rounded text-xs text-gray-600 dark:text-gray-300 mb-3"><strong>Obs:</strong> ${servico.observacoesPagamento}</div>`:""}
                        <div class="flex flex-wrap gap-2">
                            <button onclick="alterarStatusServico('${servico.id}')" class="bg-blue-500 text-white px-3 py-1 rounded text-xs hover:bg-blue-600">Alterar Status</button>
                            ${servico.valorRestante>0?`<button onclick="adicionarPagamento('${servico.id}')" class="bg-green-500 text-white px-3 py-1 rounded text-xs hover:bg-green-600">Adicionar Pagamento</button>`:`<span class="bg-green-100 text-green-800 px-3 py-1 rounded text-xs">Pago Completo</span>`}
                            <button onclick="cancelarServico('${servico.id}')" class="bg-red-500 text-white px-3 py-1 rounded text-xs hover:bg-red-600">Cancelar Serviço</button>
                        </div>
                    </div>
                `}).join("")}function atualizarFinanceiro(){const totalRecebido=servicos.reduce((sum,s)=>sum+s.valorPago,0),totalPendente=servicos.reduce((sum,s)=>sum+s.valorRestante,0),totalGeral=totalRecebido+totalPendente;document.getElementById("total-recebido").textContent=`R$ ${totalRecebido.toFixed(2).replace(".",",")}`;document.getElementById("total-pendente").textContent=`R$ ${totalPendente.toFixed(2).replace(".",",")}`;document.getElementById("total-geral").textContent=`R$ ${totalGeral.toFixed(2).replace(".",",")}`;atualizarAnalisesSemanal();atualizarAnalisesMensal();atualizarGraficoEvolucao();atualizarEstatisticasDetalhadas();const listaPagamentos=document.getElementById("lista-pagamentos");listaPagamentos.innerHTML=servicos.map(servico=>{const cliente=clientes.find(c=>c.id===servico.clienteId);return`
                    <div class="p-4 border border-gray-200 dark:border-gray-700 rounded-lg ${0===servico.valorRestante?"bg-green-50 dark:bg-green-900/20":"bg-yellow-50 dark:bg-yellow-900/20"}">
                        <div class="flex justify-between items-start mb-2">
                            <div><h4 class="font-semibold text-gray-800 dark:text-white">${cliente?cliente.nome:"Cliente não encontrado"}</h4><p class="text-sm text-gray-600 dark:text-gray-300">${servico.descricao}</p></div>
                            <div class="text-right"><p class="font-semibold text-lg">R$ ${servico.valorTotal.toFixed(2).replace(".",",")}</p><span class="inline-block px-2 py-1 rounded-full text-xs ${0===servico.valorRestante?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300"}">${0===servico.valorRestante?"Pago Completo":"Pendente"}</span></div>
                        </div>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div><span class="text-gray-600 dark:text-gray-300">Pago: </span><span class="font-medium text-green-600 dark:text-green-400">R$ ${servico.valorPago.toFixed(2).replace(".",",")}</span></div>
                            <div class="text-right"><span class="text-gray-600 dark:text-gray-300">Restante: </span><span class="font-medium ${servico.valorRestante>0?"text-red-600 dark:text-red-400":"text-green-600 dark:text-green-400"}">R$ ${servico.valorRestante.toFixed(2).replace(".",",")}</span></div>
                        </div>
                        ${servico.valorRestante>0?`<div class="mt-3"><button onclick="adicionarPagamento('${servico.id}')" class="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600">Adicionar Pagamento</button></div>`:""}
                    </div>
                `}).join("")}function atualizarAnalisesSemanal(){const hoje=new Date,inicioSemanaAtual=new Date(hoje);inicioSemanaAtual.setDate(hoje.getDate()-hoje.getDay());inicioSemanaAtual.setHours(0,0,0,0);const fimSemanaAtual=new Date(inicioSemanaAtual);fimSemanaAtual.setDate(inicioSemanaAtual.getDate()+6);fimSemanaAtual.setHours(23,59,59,999);const inicioSemanaAnterior=new Date(inicioSemanaAtual);inicioSemanaAnterior.setDate(inicioSemanaAtual.getDate()-7);const fimSemanaAnterior=new Date(inicioSemanaAtual);fimSemanaAnterior.setDate(inicioSemanaAtual.getDate()-1);const servicosSemanaAtual=servicos.filter(s=>{const dataServico=new Date(s.dataInicio);return dataServico>=inicioSemanaAtual&&dataServico<=fimSemanaAtual}),servicosSemanaAnterior=servicos.filter(s=>{const dataServico=new Date(s.dataInicio);return dataServico>=inicioSemanaAnterior&&dataServico<=fimSemanaAnterior}),receitaSemanaAtual=servicosSemanaAtual.reduce((sum,s)=>sum+s.valorTotal,0),receitaSemanaAnterior=servicosSemanaAnterior.reduce((sum,s)=>sum+s.valorTotal,0),variacaoSemanal=receitaSemanaAtual-receitaSemanaAnterior,percentualSemanal=receitaSemanaAnterior>0?variacaoSemanal/receitaSemanaAnterior*100:0;document.getElementById("receita-semana-atual").textContent=`R$ ${receitaSemanaAtual.toFixed(2).replace(".",",")}`;document.getElementById("servicos-semana-atual").textContent=servicosSemanaAtual.length;document.getElementById("receita-semana-anterior").textContent=`R$ ${receitaSemanaAnterior.toFixed(2).replace(".",",")}`;document.getElementById("servicos-semana-anterior").textContent=servicosSemanaAnterior.length;const elementoVariacaoValor=document.getElementById("variacao-semanal-valor"),elementoVariacaoPercentual=document.getElementById("variacao-semanal-percentual");elementoVariacaoValor.textContent=`${variacaoSemanal>=0?"+":""}R$ ${Math.abs(variacaoSemanal).toFixed(2).replace(".",",")}`;elementoVariacaoPercentual.textContent=`${percentualSemanal>=0?"+":""}${percentualSemanal.toFixed(1)}%`;variacaoSemanal>0?(elementoVariacaoValor.className="font-bold text-green-600",elementoVariacaoPercentual.className="text-sm text-green-600"):variacaoSemanal<0?(elementoVariacaoValor.className="font-bold text-red-600",elementoVariacaoPercentual.className="text-sm text-red-600"):(elementoVariacaoValor.className="font-bold text-gray-600",elementoVariacaoPercentual.className="text-sm text-gray-600")}function atualizarAnalisesMensal(){const hoje=new Date,inicioMesAtual=new Date(hoje.getFullYear(),hoje.getMonth(),1),fimMesAtual=new Date(hoje.getFullYear(),hoje.getMonth()+1,0),inicioMesAnterior=new Date(hoje.getFullYear(),hoje.getMonth()-1,1),fimMesAnterior=new Date(hoje.getFullYear(),hoje.getMonth(),0),servicosMesAtual=servicos.filter(s=>{const dataServico=new Date(s.dataInicio);return dataServico>=inicioMesAtual&&dataServico<=fimMesAtual}),servicosMesAnterior=servicos.filter(s=>{const dataServico=new Date(s.dataInicio);return dataServico>=inicioMesAnterior&&dataServico<=fimMesAnterior}),receitaMesAtual=servicosMesAtual.reduce((sum,s)=>sum+s.valorTotal,0),receitaMesAnterior=servicosMesAnterior.reduce((sum,s)=>sum+s.valorTotal,0),variacaoMensal=receitaMesAtual-receitaMesAnterior,percentualMensal=receitaMesAnterior>0?variacaoMensal/receitaMesAnterior*100:0;document.getElementById("receita-mes-atual").textContent=`R$ ${receitaMesAtual.toFixed(2).replace(".",",")}`;document.getElementById("servicos-mes-atual").textContent=servicosMesAtual.length;document.getElementById("receita-mes-anterior").textContent=`R$ ${receitaMesAnterior.toFixed(2).replace(".",",")}`;document.getElementById("servicos-mes-anterior").textContent=servicosMesAnterior.length;const elementoVariacaoValor=document.getElementById("variacao-mensal-valor"),elementoVariacaoPercentual=document.getElementById("variacao-mensal-percentual");elementoVariacaoValor.textContent=`${variacaoMensal>=0?"+":""}R$ ${Math.abs(variacaoMensal).toFixed(2).replace(".",",")}`;elementoVariacaoPercentual.textContent=`${percentualMensal>=0?"+":""}${percentualMensal.toFixed(1)}%`;variacaoMensal>0?(elementoVariacaoValor.className="font-bold text-green-600",elementoVariacaoPercentual.className="text-sm text-green-600"):variacaoMensal<0?(elementoVariacaoValor.className="font-bold text-red-600",elementoVariacaoPercentual.className="text-sm text-red-600"):(elementoVariacaoValor.className="font-bold text-gray-600",elementoVariacaoPercentual.className="text-sm text-gray-600")}function atualizarGraficoEvolucao(){const hoje=new Date,dadosMeses=[];for(let i=5;i>=0;i--){const mes=new Date(hoje.getFullYear(),hoje.getMonth()-i,1),proximoMes=new Date(hoje.getFullYear(),hoje.getMonth()-i+1,1),servicosDoMes=servicos.filter(s=>{const dataServico=new Date(s.dataInicio);return dataServico>=mes&&dataServico<proximoMes}),receitaDoMes=servicosDoMes.reduce((sum,s)=>sum+s.valorTotal,0);dadosMeses.push({mes:mes.toLocaleDateString("pt-BR",{month:"short",year:"2-digit"}),receita:receitaDoMes,servicos:servicosDoMes.length})}const maxReceita=Math.max(...dadosMeses.map(d=>d.receita)),grafico=document.getElementById("grafico-evolucao");grafico.innerHTML=dadosMeses.map(dado=>{const altura=maxReceita>0?dado.receita/maxReceita*100:0;return`
                    <div class="flex items-end justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                        <div class="flex-1"><div class="font-medium text-gray-800 dark:text-white">${dado.mes}</div><div class="text-sm text-gray-600 dark:text-gray-300">${dado.servicos} serviços</div></div>
                        <div class="flex items-end space-x-2"><div class="bg-blue-500 rounded-t" style="width: 20px; height: ${Math.max(altura*.6,4)}px;" title="Receita: R$ ${dado.receita.toFixed(2).replace(".",",")}"></div><div class="text-right"><div class="font-semibold text-blue-600 dark:text-blue-400">R$ ${dado.receita.toFixed(2).replace(".",",")}</div></div></div>
                    </div>
                `}).join("")}function atualizarEstatisticasDetalhadas(){const contadorServicos={};servicos.forEach(servico=>{servico.detalhesServicos?servico.detalhesServicos.forEach(detalhe=>{contadorServicos[detalhe.tipo]=(contadorServicos[detalhe.tipo]||0)+1}):contadorServicos[servico.descricao]=(contadorServicos[servico.descricao]||0)+1});const servicosOrdenados=Object.entries(contadorServicos).sort(([,a],[,b])=>b-a).slice(0,5);document.getElementById("servicos-populares").innerHTML=servicosOrdenados.length>0?servicosOrdenados.map(([servico,quantidade],index)=>`
                    <div class="flex justify-between items-center p-2 bg-gray-50 dark:bg-gray-700/50 rounded">
                        <div class="flex items-center"><span class="bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded-full mr-2">${index+1}º</span><span class="text-sm font-medium text-gray-700 dark:text-gray-200">${servico}</span></div>
                        <span class="text-sm font-semibold text-gray-600 dark:text-gray-300">${quantidade}x</span>
                    </div>
                `).join(""):`<p class="text-gray-500 dark:text-gray-400 text-sm">Nenhum serviço cadastrado ainda</p>`;const servicosConcluidos=servicos.filter(s=>"concluido"===s.status),tempoMedio=servicosConcluidos.length>0?servicosConcluidos.reduce((sum,s)=>sum+s.prazoDias,0)/servicosConcluidos.length:0;document.getElementById("tempo-medio-conclusao").textContent=tempoMedio.toFixed(1);const totalServicos=servicos.reduce((sum,s)=>sum+s.valorTotal,0),totalPago=servicos.reduce((sum,s)=>sum+s.valorPago,0),taxaPagamento=totalServicos>0?totalPago/totalServicos*100:0;document.getElementById("taxa-pagamento").textContent=`${taxaPagamento.toFixed(1)}%`}function filtrarClientesGeral(){atualizarListaClientesGeral()}function mostrarDetalhesCliente(clienteId){const cliente=clientes.find(c=>c.id===clienteId),servicosCliente=servicos.filter(s=>s.clienteId===clienteId);if(!cliente)return;document.getElementById("lista-clientes-geral").classList.add("hidden");document.getElementById("detalhes-cliente").classList.remove("hidden");document.getElementById("btn-voltar-lista").classList.remove("hidden");const totalServicos=servicosCliente.length,servicosAtivos=servicosCliente.filter(s=>"concluido"!==s.status).length,servicosConcluidos=servicosCliente.filter(s=>"concluido"===s.status).length,valorTotal=servicosCliente.reduce((sum,s)=>sum+s.valorTotal,0),valorPago=servicosCliente.reduce((sum,s)=>sum+s.valorPago,0),valorPendente=servicosCliente.reduce((sum,s)=>sum+s.valorRestante,0);document.getElementById("detalhes-cliente").innerHTML=`
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-6">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex-1"><h3 class="text-2xl font-bold text-gray-800 dark:text-white mb-2">${cliente.nome}</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm text-gray-600 dark:text-gray-300">
                                    <div><i class="fas fa-user-circle mr-2 text-blue-600 dark:text-blue-400"></i><strong>Falecido:</strong> ${cliente.falecido}</div><div><i class="fas fa-phone mr-2 text-blue-600 dark:text-blue-400"></i><strong>Telefone:</strong> ${cliente.telefone}</div><div><i class="fas fa-map-marker-alt mr-2 text-blue-600 dark:text-blue-400"></i><strong>Localização:</strong> Quadra ${cliente.quadra}, Lote ${cliente.lote}</div>
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="editarCliente('${cliente.id}')" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600"><i class="fas fa-edit mr-2"></i>Editar</button>
                                <button onclick="excluirCliente('${cliente.id}')" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600"><i class="fas fa-trash mr-2"></i>Excluir</button>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                         <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 text-center"><div class="text-2xl font-bold text-blue-600 dark:text-blue-400">${totalServicos}</div><div class="text-sm text-blue-600 dark:text-blue-400">Total de Serviços</div></div><div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4 text-center"><div class="text-2xl font-bold text-yellow-600 dark:text-yellow-400">${servicosAtivos}</div><div class="text-sm text-yellow-600 dark:text-yellow-400">Serviços Ativos</div></div><div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4 text-center"><div class="text-2xl font-bold text-green-600 dark:text-green-400">${servicosConcluidos}</div><div class="text-sm text-green-600 dark:text-green-400">Concluídos</div></div><div class="bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 rounded-lg p-4 text-center"><div class="text-xl font-bold text-purple-600 dark:text-purple-400">R$ ${valorTotal.toFixed(2).replace(".",",")}</div><div class="text-sm text-purple-600 dark:text-purple-400">Valor Total</div></div>
                    </div>
                    <div class="bg-white dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 rounded-lg p-6">
                        <h4 class="text-lg font-semibold text-gray-800 dark:text-white mb-4"><i class="fas fa-credit-card text-green-600 dark:text-green-400 mr-2"></i>Situação Financeira</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="text-center"><div class="text-xl font-bold text-green-600 dark:text-green-400">R$ ${valorPago.toFixed(2).replace(".",",")}</div><div class="text-sm text-gray-600 dark:text-gray-300">Valor Pago</div></div><div class="text-center"><div class="text-xl font-bold ${valorPendente>0?"text-red-600 dark:text-red-400":"text-green-600 dark:text-green-400"}">R$ ${valorPendente.toFixed(2).replace(".",",")}</div><div class="text-sm text-gray-600 dark:text-gray-300">Valor Pendente</div></div><div class="text-center"><div class="text-xl font-bold text-blue-600 dark:text-blue-400">${valorTotal>0?(valorPago/valorTotal*100).toFixed(1):0}%</div><div class="text-sm text-gray-600 dark:text-gray-300">Percentual Pago</div></div>
                        </div>
                        ${valorPendente>0?`<div class="mt-4 text-center"><button onclick="mostrarPagamentosPendentesCliente('${cliente.id}')" class="bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600"><i class="fas fa-money-bill mr-2"></i>Receber Pagamento</button></div>`:""}
                    </div>
                </div>
            `}function voltarListaClientes(){document.getElementById("lista-clientes-geral").classList.remove("hidden");document.getElementById("detalhes-cliente").classList.add("hidden");document.getElementById("btn-voltar-lista").classList.add("hidden")}function filtrarServicos(){atualizarListaServicos()}function alterarStatusServico(id){const servico=servicos.find(s=>s.id===id),cliente=clientes.find(c=>c.id===servico.clienteId);if(!servico)return;const modal=document.createElement("div");modal.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50";modal.innerHTML=`
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-6 max-w-md w-full mx-4 border border-gray-200 dark:border-gray-700">
                    <div class="flex justify-between items-center mb-6"><h3 class="text-xl font-bold text-gray-800 dark:text-white"><i class="fas fa-edit text-blue-600 dark:text-blue-400 mr-2"></i>Alterar Status</h3><button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors"><i class="fas fa-times text-xl"></i></button></div>
                    <div class="mb-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-lg border border-blue-200 dark:border-blue-700"><p class="font-semibold text-gray-800 dark:text-white text-lg">${cliente?cliente.nome:"Cliente não encontrado"}</p><p class="text-sm text-gray-600 dark:text-gray-300 mt-1">${servico.descricao}</p></div>
                    <div class="space-y-3">
                        <button onclick="confirmarAlteracaoStatus('${id}', 'pendente')" class="w-full p-4 text-left rounded-xl border-2 transition-all duration-300 transform hover:scale-[1.02] ${"pendente"===servico.status?"border-yellow-400 bg-yellow-50 dark:bg-yellow-900/30 shadow-lg":"border-gray-200 dark:border-gray-600 hover:border-yellow-300 hover:bg-yellow-50 dark:hover:bg-yellow-900/20 hover:shadow-md"}"><div class="flex items-center justify-between"><div class="flex items-center"><div class="w-4 h-4 rounded-full bg-yellow-500 mr-4 shadow-sm"></div><div><div class="font-semibold text-gray-800 dark:text-white text-lg">🟡 Pendente</div><div class="text-sm text-gray-600 dark:text-gray-300">Serviço ainda não foi iniciado</div></div></div>${"pendente"===servico.status?'<i class="fas fa-check-circle text-yellow-600 text-xl"></i>':'<i class="fas fa-chevron-right text-gray-400"></i>'}</div></button>
                        <button onclick="confirmarAlteracaoStatus('${id}', 'em-andamento')" class="w-full p-4 text-left rounded-xl border-2 transition-all duration-300 transform hover:scale-[1.02] ${"em-andamento"===servico.status?"border-blue-400 bg-blue-50 dark:bg-blue-900/30 shadow-lg":"border-gray-200 dark:border-gray-600 hover:border-blue-300 hover:bg-blue-50 dark:hover:bg-blue-900/20 hover:shadow-md"}"><div class="flex items-center justify-between"><div class="flex items-center"><div class="w-4 h-4 rounded-full bg-blue-500 mr-4 shadow-sm"></div><div><div class="font-semibold text-gray-800 dark:text-white text-lg">🔵 Em Andamento</div><div class="text-sm text-gray-600 dark:text-gray-300">Serviço está sendo executado</div></div></div>${"em-andamento"===servico.status?'<i class="fas fa-check-circle text-blue-600 text-xl"></i>':'<i class="fas fa-chevron-right text-gray-400"></i>'}</div></button>
                        <button onclick="confirmarAlteracaoStatus('${id}', 'concluido')" class="w-full p-4 text-left rounded-xl border-2 transition-all duration-300 transform hover:scale-[1.02] ${"concluido"===servico.status?"border-green-400 bg-green-50 dark:bg-green-900/30 shadow-lg":"border-gray-200 dark:border-gray-600 hover:border-green-300 hover:bg-green-50 dark:hover:bg-green-900/20 hover:shadow-md"}"><div class="flex items-center justify-between"><div class="flex items-center"><div class="w-4 h-4 rounded-full bg-green-500 mr-4 shadow-sm"></div><div><div class="font-semibold text-gray-800 dark:text-white text-lg">🟢 Concluído</div><div class="text-sm text-gray-600 dark:text-gray-300">Serviço foi finalizado</div></div></div>${"concluido"===servico.status?'<i class="fas fa-check-circle text-green-600 text-xl"></i>':'<i class="fas fa-chevron-right text-gray-400"></i>'}</div></button>
                    </div>
                </div>
            `;document.body.appendChild(modal)}function buscarClienteExistente(){const busca=document.getElementById("busca-cliente-form").value.toLowerCase(),resultados=document.getElementById("resultados-busca");if(busca.length<2)return void(resultados.innerHTML="");const clientesEncontrados=clientes.filter(cliente=>cliente.nome.toLowerCase().includes(busca)||cliente.falecido.toLowerCase().includes(busca)||cliente.telefone.includes(busca));0===clientesEncontrados.length?resultados.innerHTML='<p class="text-gray-500 text-sm p-2">Nenhum cliente encontrado</p>':resultados.innerHTML=clientesEncontrados.map(cliente=>`
                <div class="bg-white dark:bg-gray-700/50 border border-gray-200 dark:border-gray-600 rounded p-3 mb-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700" onclick="selecionarCliente('${cliente.id}')">
                    <div class="font-medium text-gray-800 dark:text-white">${cliente.nome}</div>
                    <div class="text-sm text-gray-600 dark:text-gray-300">Falecido: ${cliente.falecido}</div>
                    <div class="text-sm text-gray-500 dark:text-gray-400">Tel: ${cliente.telefone} | Quadra: ${cliente.quadra} | Lote: ${cliente.lote}</div>
                </div>
            `).join("")}function selecionarCliente(clienteId){const cliente=clientes.find(c=>c.id===clienteId);cliente&&(document.getElementById("nome").value=cliente.nome,document.getElementById("telefone").value=cliente.telefone,document.getElementById("quadra").value=cliente.quadra,document.getElementById("lote").value=cliente.lote,document.getElementById("falecido").value=cliente.falecido,document.getElementById("cliente-form").dataset.clienteId=clienteId,cliente.notaFiscal&&cliente.endereco&&(document.getElementById("nota-fiscal").checked=!0,toggleNotaFiscal(),document.getElementById("cep").value=cliente.endereco.cep,document.getElementById("logradouro").value=cliente.endereco.logradouro,document.getElementById("numero").value=cliente.endereco.numero,document.getElementById("bairro").value=cliente.endereco.bairro,document.getElementById("cidade").value=cliente.endereco.cidade,document.getElementById("cpf").value=cliente.endereco.cpf,document.getElementById("rg").value=cliente.endereco.rg),document.getElementById("busca-cliente-form").value="",document.getElementById("resultados-busca").innerHTML="",document.getElementById("busca-cliente-form").placeholder=`Cliente selecionado: ${cliente.nome}`,alert(`Cliente "${cliente.nome}" selecionado! Os dados foram preenchidos.`))}function editarCliente(clienteId){const cliente=clientes.find(c=>c.id===clienteId);if(!cliente)return;const modal=document.createElement("div");modal.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50";modal.innerHTML=`
                <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 max-h-96 overflow-y-auto">
                    <h3 class="text-lg font-bold mb-4">Editar Cliente</h3>
                    <form id="form-editar-cliente" onsubmit="event.preventDefault(); salvarEdicaoCliente('${clienteId}')">
                        <div class="space-y-3">
                            <div><label class="block text-sm font-medium mb-1">Nome</label><input type="text" id="edit-nome" value="${cliente.nome}" class="w-full px-3 py-2 border rounded-lg"></div>
                            <div><label class="block text-sm font-medium mb-1">Telefone</label><input type="tel" id="edit-telefone" value="${cliente.telefone}" class="w-full px-3 py-2 border rounded-lg"></div>
                            <div class="grid grid-cols-2 gap-2"><div><label class="block text-sm font-medium mb-1">Quadra</label><input type="text" id="edit-quadra" value="${cliente.quadra}" class="w-full px-3 py-2 border rounded-lg"></div><div><label class="block text-sm font-medium mb-1">Lote</label><input type="text" id="edit-lote" value="${cliente.lote}" class="w-full px-3 py-2 border rounded-lg"></div></div>
                            <div><label class="block text-sm font-medium mb-1">Falecido</label><input type="text" id="edit-falecido" value="${cliente.falecido}" class="w-full px-3 py-2 border rounded-lg"></div>
                        </div>
                        <div class="flex space-x-3 mt-6"><button type="submit" class="flex-1 bg-blue-500 text-white py-2 rounded-lg">Salvar</button><button type="button" onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-500 text-white py-2 rounded-lg">Cancelar</button></div>
                    </form>
                </div>
            `;document.body.appendChild(modal)}function mostrarClientesPendentes(){const servicosPendentes=servicos.filter(s=>s.valorRestante>0);if(0===servicosPendentes.length)return void alert("Não há pagamentos pendentes no momento!");const modal=document.createElement("div");modal.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50";modal.innerHTML=`
                <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto">
                    <div class="flex justify-between items-center mb-4"><h3 class="text-xl font-bold text-gray-800 dark:text-white"><i class="fas fa-exclamation-triangle text-yellow-500 mr-2"></i>Pagamentos Pendentes</h3><button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700"><i class="fas fa-times text-xl"></i></button></div>
                    <div class="space-y-3">
                        ${servicosPendentes.map(servico=>{const cliente=clientes.find(c=>c.id===servico.clienteId),porcentagemPaga=servico.valorTotal>0?servico.valorPago/servico.valorTotal*100:0;return`
                                <div class="border border-yellow-200 dark:border-yellow-700 rounded-lg p-4 bg-yellow-50 dark:bg-yellow-900/20">
                                    <div class="flex justify-between items-start mb-2">
                                        <div class="flex-1"><h4 class="font-semibold text-gray-800 dark:text-white">${cliente?cliente.nome:"-"}</h4><p class="text-sm text-gray-600 dark:text-gray-300">${servico.descricao}</p><p class="text-xs text-gray-500 dark:text-gray-400">Tel: ${cliente?cliente.telefone:"N/A"}</p></div>
                                        <div class="text-right"><p class="text-lg font-bold text-red-600 dark:text-red-400">R$ ${servico.valorRestante.toFixed(2).replace(".",",")}</p><p class="text-sm text-gray-600 dark:text-gray-300">de R$ ${servico.valorTotal.toFixed(2).replace(".",",")}</p></div>
                                    </div>
                                    <div class="flex flex-wrap gap-2">
                                        <button onclick="adicionarPagamento('${servico.id}'); this.closest('.fixed').remove();" class="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600"><i class="fas fa-money-bill mr-1"></i>Receber</button>
                                        <a href="https://wa.me/55${cliente?cliente.telefone.replace(/\D/g,""):""}?text=Olá%20${cliente?encodeURIComponent(cliente.nome):""}!%20Temos%20um%20valor%20pendente%20de%20R$%20${servico.valorRestante.toFixed(2).replace(".",",")}%20referente%20ao%20serviço%20${encodeURIComponent(servico.descricao)}." target="_blank" class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700"><i class="fab fa-whatsapp mr-1"></i>Cobrar</a>
                                    </div>
                                </div>
                            `}).join("")}
                    </div>
                </div>
            `;document.body.appendChild(modal)}
</script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'984eb4aff2ae1f86',t:'MTc1ODg0NzE4My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
